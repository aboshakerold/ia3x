<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Macho Menu</title>
    <style>
        body {
            background: transparent;
            margin: 0;
            padding: 0;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            font-size: 16px;
        }
        #container {
            position: absolute;
            top: 10vh;
            left: 5vw;
            width: 25vw;
            background: rgba(0,0,0,0.85);
            border: 1px solid red;
            border-radius: 4px;
            padding: 1vw;
            display: none;
        }
        .item {
            padding: 0.6vw 0;
            cursor: pointer;
            border-bottom: 1px solid #333;
        }
        .item:hover, .item.active {
            color: #ff4444;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="menu">Loading...</div>
    </div>

    <script>
        let currentMenu = [];
        let currentIndex = 0;

        window.addEventListener('message', (event) => {
            const data = event.data;
            if (data.action === 'setVisible') {
                document.getElementById('container').style.display = data.visible ? 'block' : 'none';
            } else if (data.action === 'setCurrent') {
                currentMenu = data.menu || [];
                currentIndex = (data.current || 1) - 1;
                renderMenu();
            }
        });

        function renderMenu() {
            const menuEl = document.getElementById('menu');
            menuEl.innerHTML = '';
            currentMenu.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'item' + (i === currentIndex ? ' active' : '');
                div.textContent = item.label || 'Item';
                div.onclick = () => {
                    fetch(`https://macho_menu/confirm`, { method: 'POST', body: JSON.stringify({ index: i }) });
                };
                menuEl.appendChild(div);
            });
        }

        // تأكد أن الواجهة مخفية في البداية
        document.getElementById('container').style.display = 'none';
    </script>
</body>
</html>
